# 5. SDK 초기화 및 구현

### 1. MainActivity 클래스

{% hint style="info" %}
MainActivity 클래스 설정이 없을 경우 앱 실행에 문제가 발생합니다.

Android 5.0(API Level 21) 하위 버전을 지원하는 앱의 경우 Multidex 적용이 필요합니다.
{% endhint %}

ADwhale Mediation SDK 동작을 위해서는 MainActivity(메인 액티비티 / Launch, Main) 설정이 필요합니다.

{% hint style="info" %}
더 안전한 구성요소 내보내기 설정: Android 12(API Level 31) 이상

intent-filter를 사용하는 액티비티를 포함하는 경우 exported=true 적용이 필요합니다.
{% endhint %}

```xml
<!-- AndroidManifest.xml -->
<application>
    ...
    <activity
        android:name=".MainActivity"
        android:exported="true">
        <intent-filter>
            <action android:name="android.intent.action.MAIN" />

            <category android:name="android.intent.category.LAUNCHER" />
        </intent-filter>
    </activity>
    ...
</application>
```

액티비티 Orientation 설정

{% hint style="info" %}
액티비티 형식의 랜딩을 지원하기 위해서는 아래의 설정을 추가하여야 합니다.

만약 설정하지 않으면 화면 전환 시 마다 view가 초기화 됩니다.
{% endhint %}

```xml
<!-- AndroidManifest.xml -->
<activity
    android:name=".MainActivity"
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize">
</activity>
```

### 2. Initialize 클래스

{% hint style="info" %}
광고를 요청하기 전에 초기화가 이루어져야 합니다. 초기화 방법은 초기화를 담당하는 **AdWhaleMediationAds 클래스를 MainActivity 에서 호출**해주며, 초기화 **호출 결과는 AdWhaleMediationOnInitCompleteListener 클래스를 통해 통지**됩니다. 자세한 구현은 아래 API와 샘플코드를 참고하여 구현하면 됩니다.
{% endhint %}

{% tabs %}
{% tab title="Java" %}
**AdWhaleMediationAds 클래스**

<pre class="language-java"><code class="lang-java"><strong>public static void init(Context context, AdWhaleMediationOnInitCompleteListener listener)
</strong></code></pre>

<table data-header-hidden><thead><tr><th width="348">파라미터 타입</th><th>파라미터 값</th></tr></thead><tbody><tr><td>파라미터 타입</td><td>파라미터 값</td></tr><tr><td>android.content.Context</td><td>Android Main Activity 클래스</td></tr><tr><td>net.adwhale.sdk.mediation.ads.AdWhaleMediationOnInitCompleteListener</td><td>초기화 성공 여부 콜백 리스너</td></tr></tbody></table>

**AdWhaleMediationOnInitCompleteListener 클래스**

```java
public void onInitComplete(int statusCode, String message)
```

<table data-header-hidden><thead><tr><th width="348">파라미터 타입</th><th>파라미터 값</th></tr></thead><tbody><tr><td>파라미터 타입</td><td>파라미터 값</td></tr><tr><td>int</td><td><p>초기화 결과 코드</p><p>(성공 시 <mark style="color:green;">100</mark>, 실패 시 <mark style="color:red;">200</mark>)</p></td></tr><tr><td>String</td><td><p>초기화 결과 메시지</p><p>(성공 시 <mark style="color:green;">"success!",</mark> 실패 시 <mark style="color:red;">"Initialization failed. error message:..."</mark>)</p></td></tr></tbody></table>

**초기화 샘플코드**

```java
// MainActivity 클래스에서 초기화할 경우
public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        ...
        AdWhaleMediationAds.init(this, new AdWhaleMediationOnInitCompleteListener() {
            @Override
            public void onInitComplete(int statusCode, String message) {
                Log.i(MainActivity.class.getSimpleName(), ".onInitComplete(" + statusCode + ", " + message + ");");
            }
        });
        ...
    }
}
```
{% endtab %}

{% tab title="Kotlin" %}
**AdWhaleMediationAds 클래스**

<pre class="language-kotlin"><code class="lang-kotlin"><strong>fun init(context : Context, listener : AdWhaleMediationOnInitCompleteListener) : Unit
</strong></code></pre>

<table data-header-hidden><thead><tr><th width="348">파라미터 타입</th><th>파라미터 값</th></tr></thead><tbody><tr><td>파라미터 타입</td><td>파라미터 값</td></tr><tr><td>android.content.Context</td><td>Android Main Activity 클래스</td></tr><tr><td>net.adwhale.sdk.mediation.ads.AdWhaleMediationOnInitCompleteListener</td><td>초기화 성공 여부 콜백 리스너</td></tr></tbody></table>

**AdWhaleMediationOnInitCompleteListener 클래스**

```kotlin
fun onInitComplete(statusCode : Int, message : String) : Unit
```

<table data-header-hidden><thead><tr><th width="348">파라미터 타입</th><th>파라미터 값</th></tr></thead><tbody><tr><td>파라미터 타입</td><td>파라미터 값</td></tr><tr><td>Int</td><td><p>초기화 결과 코드</p><p>(성공 시 <mark style="color:green;">100</mark>, 실패 시 <mark style="color:red;">200</mark>)</p></td></tr><tr><td>String</td><td><p>초기화 결과 메시지</p><p>(성공 시 <mark style="color:green;">"success!",</mark> 실패 시 <mark style="color:red;">"Initialization failed. error message:..."</mark>)</p></td></tr></tbody></table>

**초기화 샘플코드**

```kotlin
// MainActivity 클래스에서 초기화할 경우
class MainActivity : AppCompatActivity() {
    ...
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        ...
        AdWhaleMediationAds.init(this) { statusCode, message ->
            Log.i(MainActivity::class.simpleName, ".onInitComplete($statusCode, $message)"
            )
        }
        ...
    }
    ...
}
```
{% endtab %}
{% endtabs %}

### 3. GDPR 설정

{% hint style="info" %}
GDPR은 유럽연합(이하 'EU')의 개인정보 보호 법령으로 서비스 제공자는 EU 사용자의 개인정보 또는 그에 준하는 정보에 대한 수집 및 활용에 대해 사용자에게 동의 여부를 확인받아야 합니다. GDPR 규정 준수 및 규정에 따른 광고네트워크 동작에 필요한 절차입니다.\
\
유럽 경제 지역 (European Economic Area) 사용자에게 동의 여부를 선택할 수 있는 기능을 제공하며 애드몹 UMP (User Messaging Platform)에 의해서 처리됩니다.
{% endhint %}

{% tabs %}
{% tab title="Java" %}
**AdWhaleMediationAds 클래스**

```java
public static void requestGdprConsent(Activity activity, AdWhaleGdprConsentListener listener)
```

<table data-header-hidden><thead><tr><th width="348">파라미터 타입</th><th>파라미터 값</th></tr></thead><tbody><tr><td>파라미터 타입</td><td>파라미터 값</td></tr><tr><td>android.app.Activity</td><td>Android Main Activity 클래스</td></tr><tr><td>net.adwhale.sdk.mediation.ads.AdWhaleGdprConsentListener</td><td>GDPR UMP 호출 성공/실패</td></tr></tbody></table>

<pre class="language-java"><code class="lang-java"><strong>public static void resetGdprConsentStatus(Activity activity)
</strong></code></pre>

<table data-header-hidden><thead><tr><th width="348">파라미터 타입</th><th>파라미터 값</th></tr></thead><tbody><tr><td>파라미터 타입</td><td>파라미터 값</td></tr><tr><td>android.app.Activity</td><td>Android Main Activity 클래스</td></tr></tbody></table>

{% hint style="info" %}
setGdpr은 자체적으로 GDPR 선택창을 사용하실 경우 사용하며 AdWhale SDK 내부 GDPR 세팅을 위해 호출.
{% endhint %}

<pre class="language-java"><code class="lang-java"><strong>public static void setGdpr(boolean hasConsent)
</strong></code></pre>

<table data-header-hidden><thead><tr><th width="348">파라미터 타입</th><th>파라미터 값</th></tr></thead><tbody><tr><td>파라미터 타입</td><td>파라미터 값</td></tr><tr><td>boolean</td><td>true : gdpr 동의<br>false : gdpr 비동의</td></tr></tbody></table>

**초기화 샘플코드**

```java
AdWhaleMediationAds.requestGdprConsent(this, (isSuccess, message) -> {
                String result = "GDPR Consent: " + (isSuccess ? "Success" : "Failed") + ", " + message;
                Log.d(MainActivity.class.getSimpleName(), result);
            });
```

#### **에러 메시지**&#x20;

<table data-header-hidden><thead><tr><th width="348">에러 종류</th><th>에러 메시지</th></tr></thead><tbody><tr><td><strong>TIME_OUT</strong><br><sub>(WebView 로 consent form 을 불러오는 데 시간이 너무 오래 걸려 발생 또는 네트워크 연결에 실패한 경우)</sub></td><td>Web view timed out</td></tr><tr><td></td><td>Timed out while loading consent form</td></tr><tr><td><strong>INTERNET_ERROR</strong><br><sub>(네트워크 연결이 없거나, 요청이 서버까지 도달하지 못한 경우)</sub></td><td>Failed to load consent form due to network error</td></tr><tr><td></td><td>No internet connection</td></tr><tr><td><strong>INTERNAL_ERROR</strong><br><sub>(SDK 내부 로직이나 예외적인 상황에서 발생. 드물게 WebView 초기화 실패 등에서도 볼 수 있음)</sub></td><td>Internal error</td></tr><tr><td></td><td>An unexpected error occurred while loading the consent form</td></tr><tr><td><strong>INVALID_OPERATION</strong><br><sub>(아직 load 되지 않은 폼을 show 하려 하거나, 이미 표시 중인데 다시 show 호출했을 때 발생)</sub></td><td>Invalid operation. Consent form already showing</td></tr><tr><td></td><td>Invalid operation: Consent form not ready</td></tr></tbody></table>
{% endtab %}

{% tab title="Kotlin" %}
**AdWhaleMediationAds 클래스**

```kotlin
fun requestGdprConsent(activity: Activity, listener: AdWhaleGdprConsentListener) 
```

<table data-header-hidden><thead><tr><th width="348">파라미터 타입</th><th>파라미터 값</th></tr></thead><tbody><tr><td>파라미터 타입</td><td>파라미터 값</td></tr><tr><td>android.app.Activity</td><td>Android Main Activity 클래스</td></tr><tr><td>net.adwhale.sdk.mediation.ads.AdWhaleGdprConsentListener</td><td>GDPR UMP 호출 성공/실패</td></tr></tbody></table>

```kotlin
fun resetGdprConsentStatus(activity: Activity)
```

<table data-header-hidden><thead><tr><th width="348">파라미터 타입</th><th>파라미터 값</th></tr></thead><tbody><tr><td>파라미터 타입</td><td>파라미터 값</td></tr><tr><td>android.app.Activity</td><td>Android Main Activity 클래스</td></tr></tbody></table>

{% hint style="info" %}
setGdpr은 자체적으로 GDPR 선택창을 사용하실 경우 사용하며 AdWhale SDK 내부 GDPR 세팅을 위해 호출.
{% endhint %}

```kotlin
fun setGdpr(hasConsent: Boolean)
```

<table data-header-hidden><thead><tr><th width="348">파라미터 타입</th><th>파라미터 값</th></tr></thead><tbody><tr><td>파라미터 타입</td><td>파라미터 값</td></tr><tr><td>Boolean</td><td>true : gdpr 동의<br>false : gdpr 비동의</td></tr></tbody></table>

**초기화 샘플코드**

```java
AdWhaleMediationAds.init(this, object : AdWhaleMediationOnInitCompleteListener {
    override fun onInitComplete(statusCode: Int, message: String) {
        Log.i(MainActivity::class.java.simpleName, ".onInitComplete($statusCode, $message);")
    }
})

AdWhaleMediationAds.requestGdprConsent(this, object : AdWhaleGdprConsentListener {
    override fun onResult(isSuccess: Boolean, message: String) {
        val result = "GDPR Consent: ${if (isSuccess) "Success" else "Failed"}, $message"
        Log.d(MainActivity::class.java.simpleName, result)
    }
})
```

#### **에러 메시지**&#x20;

<table data-header-hidden><thead><tr><th width="348">에러 종류</th><th>에러 메시지</th></tr></thead><tbody><tr><td><strong>TIME_OUT</strong><br><sub>(WebView 로 consent form 을 불러오는 데 시간이 너무 오래 걸려 발생 또는 네트워크 연결에 실패한 경우)</sub></td><td>Web view timed out</td></tr><tr><td></td><td>Timed out while loading consent form</td></tr><tr><td><strong>INTERNET_ERROR</strong><br><sub>(네트워크 연결이 없거나, 요청이 서버까지 도달하지 못한 경우)</sub></td><td>Failed to load consent form due to network error</td></tr><tr><td></td><td>No internet connection</td></tr><tr><td><strong>INTERNAL_ERROR</strong><br><sub>(SDK 내부 로직이나 예외적인 상황에서 발생. 드물게 WebView 초기화 실패 등에서도 볼 수 있음)</sub></td><td>Internal error</td></tr><tr><td></td><td>An unexpected error occurred while loading the consent form</td></tr><tr><td><strong>INVALID_OPERATION</strong><br><sub>(아직 load 되지 않은 폼을 show 하려 하거나, 이미 표시 중인데 다시 show 호출했을 때 발생)</sub></td><td>Invalid operation. Consent form already showing</td></tr><tr><td></td><td>Invalid operation: Consent form not ready</td></tr></tbody></table>
{% endtab %}
{% endtabs %}











